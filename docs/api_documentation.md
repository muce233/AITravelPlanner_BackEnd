# AIæ—…è¡Œè§„åˆ’åŠ©æ‰‹ - APIæ¥å£æ–‡æ¡£

## é¡¹ç›®æ¦‚è¿°

AIæ—…è¡Œè§„åˆ’åŠ©æ‰‹æ˜¯ä¸€ä¸ªåŸºäºFastAPIçš„åç«¯æœåŠ¡ï¼Œæä¾›æ™ºèƒ½æ—…è¡Œè§„åˆ’ã€èŠå¤©å¯¹è¯ã€è¯­éŸ³è¯†åˆ«ã€åœ°å›¾æœåŠ¡ç­‰åŠŸèƒ½ã€‚

**åŸºç¡€ä¿¡æ¯ï¼š**
- **APIåœ°å€**: `http://localhost:8000`
- **è®¤è¯æ–¹å¼**: Bearer Token (JWT)
- **æ•°æ®æ ¼å¼**: JSON

## å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨æœåŠ¡
```bash
uv run python main.py
```

### 2. æµ‹è¯•è´¦å·
- **ç”¨æˆ·å**: `15666666666`
- **å¯†ç **: `666666`

### 3. è·å–è®¿é—®ä»¤ç‰Œ
```bash
curl -X POST "http://localhost:8000/api/auth/login" \
  -H "Content-Type: application/json" \
  -d '{"username": "15666666666", "password": "666666"}'
```

## APIæ¥å£åˆ†ç±»

### ğŸ” è®¤è¯ç›¸å…³ (Authentication)
### ğŸ‘¥ ç”¨æˆ·ç®¡ç† (Users)
### ğŸ’¬ æ™ºèƒ½èŠå¤© (Chat)
### ğŸ—£ï¸ è¯­éŸ³æœåŠ¡ (Speech)
### ğŸ—ºï¸ åœ°å›¾æœåŠ¡ (Map)
### âœˆï¸ æ—…è¡Œç®¡ç† (Trips)
### ğŸ’° è´¹ç”¨ç®¡ç† (Expenses)
### ğŸ“‹ è¡Œç¨‹è¯¦æƒ… (Trip Details)

---

## ğŸ” è®¤è¯ç›¸å…³ (Authentication)

### ç”¨æˆ·ç™»å½•
- **ç«¯ç‚¹**: `POST /api/auth/login`
- **æè¿°**: ç”¨æˆ·ç™»å½•è·å–è®¿é—®ä»¤ç‰Œ
- **è®¤è¯**: ä¸éœ€è¦

**è¯·æ±‚å‚æ•°:**
```json
{
  "username": "string",
  "password": "string"
}
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
  "token_type": "bearer"
}
```

**é”™è¯¯å“åº”:**
```json
{
  "detail": "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"
}
```

### ç”¨æˆ·ç™»å‡º
- **ç«¯ç‚¹**: `POST /api/auth/logout`
- **æè¿°**: ç”¨æˆ·ç™»å‡º
- **è®¤è¯**: éœ€è¦

**å“åº”ç¤ºä¾‹:**
```json
{
  "message": "ç™»å‡ºæˆåŠŸ"
}
```

---

## ğŸ‘¥ ç”¨æˆ·ç®¡ç† (Users)

### ç”¨æˆ·æ³¨å†Œ
- **ç«¯ç‚¹**: `POST /api/users/register`
- **æè¿°**: æ–°ç”¨æˆ·æ³¨å†Œ
- **è®¤è¯**: ä¸éœ€è¦

**è¯·æ±‚å‚æ•°:**
```json
{
  "username": "string",
  "phone_number": "string",
  "password": "string"
}
```

### è·å–ç”¨æˆ·ä¿¡æ¯
- **ç«¯ç‚¹**: `GET /api/users/profile`
- **æè¿°**: è·å–å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯
- **è®¤è¯**: éœ€è¦

### æ›´æ–°ç”¨æˆ·ä¿¡æ¯
- **ç«¯ç‚¹**: `PUT /api/users/profile`
- **æè¿°**: æ›´æ–°å½“å‰ç”¨æˆ·ä¿¡æ¯
- **è®¤è¯**: éœ€è¦

---

## ğŸ’¬ æ™ºèƒ½èŠå¤© (Chat)



### èŠå¤©è¡¥å…¨ï¼ˆéæµå¼ï¼‰
- **ç«¯ç‚¹**: `POST /api/chat/completions`
- **æè¿°**: å‘é€èŠå¤©æ¶ˆæ¯å¹¶è·å–AIå›å¤ï¼ˆéæµå¼ï¼‰
- **è®¤è¯**: éœ€è¦

**è¯·æ±‚å‚æ•°:**
```json
{
  "messages": [
    {
      "role": "user",
      "content": "ä½ å¥½ï¼Œè¯·å¸®æˆ‘è§„åˆ’ä¸€ä¸ªæ—…è¡Œ"
    }
  ],
  "model": "chat-model",
  "temperature": 0.7,
  "max_tokens": 1000
}
```

### èŠå¤©è¡¥å…¨ï¼ˆæµå¼ï¼‰
- **ç«¯ç‚¹**: `POST /api/chat/completions/stream`
- **æè¿°**: å‘é€èŠå¤©æ¶ˆæ¯å¹¶è·å–AIå›å¤ï¼ˆæµå¼å“åº”ï¼‰
- **è®¤è¯**: éœ€è¦

### å¯¹è¯ç®¡ç†

#### è·å–å¯¹è¯åˆ—è¡¨
- **ç«¯ç‚¹**: `GET /api/chat/conversations`
- **å‚æ•°**: 
  - `page` (å¯é€‰): é¡µç ï¼Œé»˜è®¤1
  - `page_size` (å¯é€‰): æ¯é¡µæ•°é‡ï¼Œé»˜è®¤20
- **è®¤è¯**: éœ€è¦

#### åˆ›å»ºæ–°å¯¹è¯
- **ç«¯ç‚¹**: `POST /api/chat/conversations`
- **è®¤è¯**: éœ€è¦

**è¯·æ±‚å‚æ•°:**
```json
{
  "title": "æˆ‘çš„æ–°å¯¹è¯",
  "model": "chat-model"
}
```

#### è·å–å¯¹è¯è¯¦æƒ…
- **ç«¯ç‚¹**: `GET /api/chat/conversations/{conversation_id}`
- **è®¤è¯**: éœ€è¦

#### æ›´æ–°å¯¹è¯ä¿¡æ¯
- **ç«¯ç‚¹**: `PUT /api/chat/conversations/{conversation_id}`
- **è®¤è¯**: éœ€è¦

**è¯·æ±‚å‚æ•°:**
```json
{
  "title": "æ–°çš„å¯¹è¯æ ‡é¢˜",
  "is_active": true
}
```

#### åˆ é™¤å¯¹è¯
- **ç«¯ç‚¹**: `DELETE /api/chat/conversations/{conversation_id}`
- **è®¤è¯**: éœ€è¦

#### æ¸…ç©ºå¯¹è¯æ¶ˆæ¯
- **ç«¯ç‚¹**: `POST /api/chat/conversations/{conversation_id}/clear`
- **è®¤è¯**: éœ€è¦

---

## ğŸ—£ï¸ è¯­éŸ³æœåŠ¡ (Speech)

### è¯­éŸ³è¯†åˆ«
- **ç«¯ç‚¹**: `POST /api/speech/recognize`
- **æè¿°**: å°†è¯­éŸ³è½¬æ¢ä¸ºæ–‡æœ¬
- **è®¤è¯**: éœ€è¦

### è¯­éŸ³åˆæˆ
- **ç«¯ç‚¹**: `POST /api/speech/synthesize`
- **æè¿°**: å°†æ–‡æœ¬è½¬æ¢ä¸ºè¯­éŸ³
- **è®¤è¯**: éœ€è¦

---

## ğŸ—ºï¸ åœ°å›¾æœåŠ¡ (Map)

### åœ°ç‚¹æœç´¢
- **ç«¯ç‚¹**: `GET /api/map/search`
- **å‚æ•°**:
  - `query`: æœç´¢å…³é”®è¯
  - `location` (å¯é€‰): ä½ç½®åæ ‡
- **è®¤è¯**: éœ€è¦

### è·¯çº¿è§„åˆ’
- **ç«¯ç‚¹**: `GET /api/map/directions`
- **å‚æ•°**:
  - `origin`: èµ·ç‚¹
  - `destination`: ç»ˆç‚¹
  - `mode` (å¯é€‰): äº¤é€šæ–¹å¼
- **è®¤è¯**: éœ€è¦

### åœ°ç‚¹è¯¦æƒ…
- **ç«¯ç‚¹**: `GET /api/map/place/details`
- **å‚æ•°**:
  - `place_id`: åœ°ç‚¹ID
- **è®¤è¯**: éœ€è¦

---

## âœˆï¸ æ—…è¡Œç®¡ç† (Trips)

### åˆ›å»ºæ—…è¡Œ
- **ç«¯ç‚¹**: `POST /api/trips/`
- **æè¿°**: åˆ›å»ºæ–°çš„æ—…è¡Œè®¡åˆ’
- **è®¤è¯**: éœ€è¦

**è¯·æ±‚å‚æ•°:**
```json
{
  "title": "åŒ—äº¬ä¸‰æ—¥æ¸¸",
  "description": "æ¢ç´¢åŒ—äº¬çš„å†å²æ–‡åŒ–",
  "start_date": "2024-01-01",
  "end_date": "2024-01-03",
  "destination": "åŒ—äº¬",
  "budget": 5000
}
```

### è·å–æ—…è¡Œåˆ—è¡¨
- **ç«¯ç‚¹**: `GET /api/trips/`
- **æè¿°**: è·å–ç”¨æˆ·çš„æ‰€æœ‰æ—…è¡Œè®¡åˆ’
- **è®¤è¯**: éœ€è¦

### è·å–æ—…è¡Œè¯¦æƒ…
- **ç«¯ç‚¹**: `GET /api/trips/{trip_id}`
- **è®¤è¯**: éœ€è¦

### æ›´æ–°æ—…è¡Œä¿¡æ¯
- **ç«¯ç‚¹**: `PUT /api/trips/{trip_id}`
- **è®¤è¯**: éœ€è¦

### åˆ é™¤æ—…è¡Œ
- **ç«¯ç‚¹**: `DELETE /api/trips/{trip_id}`
- **è®¤è¯**: éœ€è¦

### ç”Ÿæˆæ—…è¡Œè®¡åˆ’
- **ç«¯ç‚¹**: `POST /api/trips/{trip_id}/generate`
- **æè¿°**: ä½¿ç”¨AIç”Ÿæˆè¯¦ç»†çš„æ—…è¡Œè®¡åˆ’
- **è®¤è¯**: éœ€è¦

---

## ğŸ’° è´¹ç”¨ç®¡ç† (Expenses)

### åˆ›å»ºè´¹ç”¨è®°å½•
- **ç«¯ç‚¹**: `POST /api/expenses/`
- **æè¿°**: æ·»åŠ æ—…è¡Œè´¹ç”¨è®°å½•
- **è®¤è¯**: éœ€è¦

**è¯·æ±‚å‚æ•°:**
```json
{
  "trip_id": 1,
  "category": "äº¤é€š",
  "amount": 100.0,
  "description": "åœ°é“ç¥¨",
  "date": "2024-01-01"
}
```

### è·å–è´¹ç”¨åˆ—è¡¨
- **ç«¯ç‚¹**: `GET /api/expenses/`
- **å‚æ•°**:
  - `trip_id` (å¯é€‰): æ—…è¡ŒID
- **è®¤è¯**: éœ€è¦

### æ›´æ–°è´¹ç”¨è®°å½•
- **ç«¯ç‚¹**: `PUT /api/expenses/{expense_id}`
- **è®¤è¯**: éœ€è¦

### åˆ é™¤è´¹ç”¨è®°å½•
- **ç«¯ç‚¹**: `DELETE /api/expenses/{expense_id}`
- **è®¤è¯**: éœ€è¦

### é¢„ç®—åˆ†æ
- **ç«¯ç‚¹**: `GET /api/expenses/budget/analysis`
- **å‚æ•°**:
  - `trip_id`: æ—…è¡ŒID
- **è®¤è¯**: éœ€è¦

---

## ğŸ“‹ è¡Œç¨‹è¯¦æƒ… (Trip Details)

### åˆ›å»ºè¡Œç¨‹è¯¦æƒ…
- **ç«¯ç‚¹**: `POST /api/trip-details/`
- **æè¿°**: æ·»åŠ æ—…è¡Œè¡Œç¨‹è¯¦æƒ…
- **è®¤è¯**: éœ€è¦

**è¯·æ±‚å‚æ•°:**
```json
{
  "trip_id": 1,
  "day": 1,
  "time": "09:00",
  "activity": "å‚è§‚æ•…å®«",
  "location": "æ•…å®«",
  "description": "æ¢ç´¢ä¸­å›½å¤ä»£çš‡å®«",
  "estimated_cost": 60.0
}
```

### è·å–è¡Œç¨‹è¯¦æƒ…åˆ—è¡¨
- **ç«¯ç‚¹**: `GET /api/trip-details/`
- **å‚æ•°**:
  - `trip_id`: æ—…è¡ŒID
- **è®¤è¯**: éœ€è¦

### æ›´æ–°è¡Œç¨‹è¯¦æƒ…
- **ç«¯ç‚¹**: `PUT /api/trip-details/{detail_id}`
- **è®¤è¯**: éœ€è¦

### åˆ é™¤è¡Œç¨‹è¯¦æƒ…
- **ç«¯ç‚¹**: `DELETE /api/trip-details/{detail_id}`
- **è®¤è¯**: éœ€è¦

---

## é”™è¯¯å¤„ç†

### å¸¸è§HTTPçŠ¶æ€ç 

- `200`: è¯·æ±‚æˆåŠŸ
- `400`: è¯·æ±‚å‚æ•°é”™è¯¯
- `401`: æœªæˆæƒè®¿é—®
- `403`: æƒé™ä¸è¶³
- `404`: èµ„æºä¸å­˜åœ¨
- `429`: è¯·æ±‚é¢‘ç‡è¿‡é«˜
- `500`: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

### é”™è¯¯å“åº”æ ¼å¼
```json
{
  "detail": "é”™è¯¯æè¿°ä¿¡æ¯"
}
```

---

## è®¤è¯å¤´æ ¼å¼

æ‰€æœ‰éœ€è¦è®¤è¯çš„æ¥å£éƒ½éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­åŒ…å«Bearer Tokenï¼š

```http
Authorization: Bearer <access_token>
```

---

## æ³¨æ„äº‹é¡¹

1. **è¯·æ±‚é¢‘ç‡é™åˆ¶**: éƒ¨åˆ†æ¥å£æœ‰è¯·æ±‚é¢‘ç‡é™åˆ¶ï¼Œé¿å…é¢‘ç¹è°ƒç”¨
2. **æ•°æ®æ ¼å¼**: æ‰€æœ‰æ—¥æœŸæ ¼å¼ä¸º `YYYY-MM-DD`ï¼Œæ—¶é—´æ ¼å¼ä¸º `HH:MM`
3. **æ–‡ä»¶ä¸Šä¼ **: è¯­éŸ³æœåŠ¡æ”¯æŒéŸ³é¢‘æ–‡ä»¶ä¸Šä¼ 
4. **å®æ—¶æ€§**: æµå¼èŠå¤©æ¥å£è¿”å›SSEæ ¼å¼æ•°æ®
5. **å®‰å…¨æ€§**: æ•æ„Ÿæ“ä½œéœ€è¦ç”¨æˆ·è®¤è¯

---

## æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿã€‚